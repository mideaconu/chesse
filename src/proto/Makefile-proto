.DEFAULT_GOAL = proto/help

# Coloured text
gprint := printf '\033[32m%s\033[0m'  # green
bprint := printf '\033[36m%s\033[0m'  # blue

checkmark := "  \xE2\x9C\x94\n"

## Show a list of available commands
.PHONY += proto/help
proto/help :
	@grep -E '^[a-zA-Z_-]+ :.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'


## Compile the protobuf files
.PHONY += proto/build
proto/build :
	@$(gprint) "Compilion of protobuf files"
	@buf build
	@printf $(checkmark)


## Lint the protobuf files
.PHONY += proto/lint
proto/lint :
	@$(gprint) "Linting of protobuf files"
	@buf lint
	@printf $(checkmark)


## Generate the protobuf files
.PHONY += proto/gen-py
proto/gen-py :
	@$(bprint) "- Python code generation"
	@buf generate
	@printf $(checkmark)

## Generate the protobuf libraries
.PHONY += proto/gen
proto/gen :
	@$(MAKE) proto/gen-py
	@$(gprint) "Code generation"
	@printf $(checkmark)


## Generate the protobuf code
.PHONY += proto
proto :
	@$(MAKE) proto/build
	@$(MAKE) proto/lint
	@$(MAKE) proto/gen
