extends layout

block scripts
    link(rel="stylesheet",
        href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css",
        integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU",
        crossorigin="anonymous")
    script(
        src="https://code.jquery.com/jquery-3.5.1.min.js",
        integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2",
        crossorigin="anonymous")
    script(
        src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js",
        integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD",
        crossorigin="anonymous")

block content
    .game-container
        .title-item
            #title CheSSE
            #subtitle Chess Similarity Search Engine
        .board
            #abc
        .panel
            p #{game.white.name}(#{game.white.elo}) - #{game.black.name}(#{game.black.elo})
            p #{game.context.event}, Round #{game.context.round}
            p #{game.context.date}
            button(onclick='updatePosition(' + 0 + ')') First
            button(onclick='updateToPrev()') Prev
            button(onclick='updateToNext()') Next
            button(onclick='updateToLast()') Last
            p
                - for (var i = 0; i < game.moves.length; i++)
                    div(onclick='updatePosition(' + i + ')') #{game.moves[i].uci}
    script.
        var moves = !{JSON.stringify(game.moves)};
        var currentMove = 0;
        var board = Chessboard("abc", {pieceTheme: 'images/chesspieces/default/{piece}.png', position: moves[currentMove].fen});
        function updatePosition(i) {
            board.position(moves[i].fen);
            currentMove = i;
            console.log(currentMove);
        }
        function updateToPrev() {
            if (currentMove > 0) {
                currentMove = currentMove - 1;
                board.position(moves[currentMove].fen);
            }
        }
        function updateToNext() {
            if (currentMove < moves.length - 1) {
                currentMove = currentMove + 1;
                board.position(moves[currentMove].fen);
            }
        }
        function updateToLast() {
            currentMove = moves.length - 1;
            board.position(moves[currentMove].fen);
        }
