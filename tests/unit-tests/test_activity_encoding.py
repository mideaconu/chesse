import chess
import pytest

from src.encoding import activity_encoding


@pytest.mark.parametrize(
    "board, expected_encoding",
    [
        pytest.param(
            chess.Board(fen="r1bqk1nr/pp1n1ppp/4p3/2b5/4p3/2P1B3/PP1N1PPP/R2QKBNR w KQkq - 0 1"),
            {
                "Ke2|0.89",
                "Qa4|0.67",
                "Qb1|0.78",
                "Qb3|0.78",
                "Qc1|0.89",
                "Qc2|0.89",
                "Qe2|0.89",
                "Qf3|0.78",
                "Qg4|0.67",
                "Qh5|0.56",
                "Rb1|0.89",
                "Rc1|0.78",
                "Ba6|0.45",
                "Bb5|0.56",
                "Bc4|0.67",
                "Bc5|0.78",
                "Bd3|0.78",
                "Bd4|0.89",
                "Be2|0.89",
                "Bf4|0.89",
                "Bg5|0.78",
                "Bh6|0.67",
                "Nb1|0.78",
                "Nb3|0.78",
                "Nc4|0.78",
                "Ne2|0.78",
                "Ne4|0.78",
                "Nf3|0.78",
                "Nh3|0.78",
                "Pa3|0.89",
                "Pa4|0.78",
                "Pb3|0.89",
                "Pb4|0.78",
                "Pc4|0.89",
                "Pf3|0.89",
                "Pf4|0.78",
                "Pg3|0.89",
                "Pg4|0.78",
                "Ph3|0.89",
                "Ph4|0.78",
                "ke7|0.89",
                "kf8|0.89",
                "qa5|0.67",
                "qb6|0.78",
                "qc7|0.89",
                "qe7|0.89",
                "qf6|0.78",
                "qg5|0.67",
                "qh4|0.56",
                "rb8|0.89",
                "ba3|0.78",
                "bb4|0.89",
                "bb6|0.89",
                "bd4|0.89",
                "bd6|0.89",
                "be3|0.78",
                "be7|0.78",
                "bf8|0.67",
                "nb6|0.78",
                "nb8|0.78",
                "ne5|0.78",
                "ne7|0.78",
                "nf6|0.78",
                "nf8|0.78",
                "nh6|0.78",
                "pa5|0.78",
                "pa6|0.89",
                "pb5|0.78",
                "pb6|0.89",
                "pe5|0.89",
                "pf5|0.78",
                "pf6|0.89",
                "pg5|0.78",
                "pg6|0.89",
                "ph5|0.78",
                "ph6|0.89",
            },
            id="Opening",
        ),
        pytest.param(
            chess.Board(fen="rr4k1/2qbpp2/1n1p1b1p/p2P2p1/2pP1PP1/Q1N4P/PPP1RBB1/2K1R3 w - -"),
            {
                "Be3|0.89",
                "Be4|0.78",
                "Bf1|0.89",
                "Bf3|0.89",
                "Bg1|0.89",
                "Bg3|0.89",
                "Bh1|0.89",
                "Bh4|0.78",
                "Kb1|0.89",
                "Kd1|0.89",
                "Kd2|0.89",
                "Na4|0.78",
                "Nb1|0.78",
                "Nb5|0.78",
                "Nd1|0.78",
                "Ne4|0.78",
                "Pb3|0.89",
                "Pb4|0.78",
                "Pf5|0.89",
                "Pg5|0.89",
                "Ph4|0.89",
                "Qa4|0.89",
                "Qa5|0.78",
                "Qb3|0.89",
                "Qb4|0.89",
                "Qc5|0.78",
                "Qd6|0.67",
                "Rd1|0.89",
                "Rd2|0.89",
                "Re3|0.89",
                "Re4|0.78",
                "Re5|0.67",
                "Re6|0.56",
                "Re7|0.45",
                "Rf1|0.89",
                "Rg1|0.78",
                "Rh1|0.67",
                "ba4|0.67",
                "bb5|0.78",
                "bc6|0.89",
                "bc8|0.89",
                "bd4|0.78",
                "be5|0.89",
                "be6|0.89",
                "be8|0.89",
                "bf5|0.78",
                "bg4|0.67",
                "bg7|0.89",
                "bh8|0.78",
                "kf8|0.89",
                "kg7|0.89",
                "kh7|0.89",
                "kh8|0.89",
                "na4|0.78",
                "nc8|0.78",
                "nd5|0.78",
                "pa4|0.89",
                "pe5|0.78",
                "pe6|0.89",
                "pf4|0.89",
                "ph5|0.89",
                "qa7|0.78",
                "qb7|0.89",
                "qc5|0.78",
                "qc6|0.89",
                "qc8|0.89",
                "qd8|0.89",
                "ra6|0.78",
                "ra7|0.89",
                "rb7|0.89",
                "rc8|0.89",
                "rd8|0.78",
                "re8|0.67",
                "rf8|0.56",
            },
        ),
        pytest.param(
            chess.Board(fen="1R1R4/p4pp1/4pk2/2pb1P2/r5Pp/2PK3P/2P5/8 w - - 0 1"),
            {
                "Kc4|0.89",
                "Kd2|0.89",
                "Kd4|0.89",
                "Ke2|0.89",
                "Ke3|0.89",
                "Ke4|0.89",
                "Ra8|0.89",
                "Rb1|0.23",
                "Rb2|0.34",
                "Rb3|0.45",
                "Rb4|0.56",
                "Rb5|0.67",
                "Rb6|0.78",
                "Rb7|0.89",
                "Rc8|0.89",
                "Rd5|0.67",
                "Rd6|0.78",
                "Rd7|0.89",
                "Re8|0.89",
                "Rf8|0.78",
                "Rg8|0.67",
                "Rh8|0.56",
                "Pc4|0.89",
                "Pe6|0.89",
                "Pg5|0.89",
                "ke5|0.89",
                "ke7|0.89",
                "kf5|0.89",
                "kg5|0.89",
                "kg6|0.89",
                "ra1|0.67",
                "ra2|0.78",
                "ra3|0.89",
                "ra5|0.89",
                "ra6|0.78",
                "rb4|0.89",
                "rc4|0.78",
                "rd4|0.67",
                "re4|0.56",
                "rf4|0.45",
                "rg4|0.34",
                "ba2|0.67",
                "ba8|0.67",
                "bb3|0.78",
                "bb7|0.78",
                "bc4|0.89",
                "bc6|0.89",
                "be4|0.89",
                "bf3|0.78",
                "bg2|0.67",
                "bh1|0.56",
                "pa5|0.78",
                "pa6|0.89",
                "pc4|0.89",
                "pe5|0.89",
                "pf5|0.89",
                "pg5|0.78",
                "pg6|0.89",
            },
            id="Endgame",
        ),
    ],
)
def test_get_activity_encoding(board, expected_encoding):
    assert activity_encoding.encode(board) == expected_encoding
